#!/usr/bin/env bash
#
# Usage:
#
#  source reactor-env $SOURCED
#
#  > Requires: ${__script_dir}
#  > Optional: $SOURCED => [ 1, 0 ]
#
#=========================================================================================
# Initialization
#
export SOURCED=${1:-0}

export __user_id="$(id -u)"
export __user_name="$(id -nu)"
export __group_id="$(id -g)"
export __group_name="$(id -ng)"
export __docker_group_id="$(cut -d: -f3 < <(getent group docker))"
export __home_dir="/home/${__user_name}"

source "${__script_dir}/state/load.sh"

load_utilities hooks cli
source "${__script_dir}/state/initialize.sh"
load_utilities

# Initialize Docker registry
if [[ $REACTOR_LOCAL -eq 0 ]] || [[ $SOURCED -eq 1 ]]; then
  if kubernetes_status; then
    add_docker_environment
  fi
fi
load_library utilities
run_hook initialize_utilities

for file in "${__script_dir}/commands"/*.sh; do
  source "$file"
done
load_library commands
run_hook initialize_commands
